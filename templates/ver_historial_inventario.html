{% extends "base.html" %}
{% block title %}Historial de Movimientos{% endblock %}
{% block header %}ğŸ“œ Historial de Movimientos del Inventario{% endblock %}

{% block content %}
<div class="container py-3">

    <!-- Barra de filtros -->
    <form class="row g-2 mb-3" method="GET" action="{{ url_for('ver_historial_inventario') }}">
    <div class="col-6 col-md-2">
        <select name="color_id" class="form-select form-select-sm">
        <option value="">ğŸ¨ Todos los colores</option>
        {% for c in colores %}
            <option value="{{ c.id }}" {% if color_seleccionado == c.id|string %}selected{% endif %}>{{ c.nombre }}</option>
        {% endfor %}
        </select>
    </div>

    <div class="col-6 col-md-2">
        <select name="talla_id" class="form-select form-select-sm">
        <option value="">ğŸ‘• Todas las tallas</option>
        {% for t in tallas %}
            <option value="{{ t.id }}" {% if talla_seleccionada == t.id|string %}selected{% endif %}>{{ t.nombre }}</option>
        {% endfor %}
        </select>
    </div>

    <div class="col-6 col-md-2">
        <select name="estado" class="form-select form-select-sm">
        <option value="">ğŸ“Œ Cualquier estado</option>
        {% for s in estados %}
            <option value="{{ s.id }}" {% if estado_seleccionado == s.id|string %}selected{% endif %}>{{ s.nombre }}</option>
        {% endfor %}
        </select>
    </div>

    <div class="col-6 col-md-2 d-flex gap-1">
        <button class="btn btn-primary btn-sm flex-fill" type="submit">
        <i class="bi bi-funnel-fill me-1"></i> Filtrar
        </button>
        <a href="{{ url_for('ver_historial_inventario') }}" class="btn btn-outline-secondary btn-sm flex-fill">
        <i class="bi bi-x-circle me-1"></i> Limpiar
        </a>
    </div>
    </form>
    {% if movimientos %}
    <div class="table-responsive">
      <table class="table table-striped table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>ğŸ¨ Color</th>
            <th>ğŸ‘• Talla</th>
            <th>ğŸ“¦ Cantidad</th>
            <th>âš™ï¸ Tipo Movimiento</th>
            <th>ğŸ“Œ Estado</th>
            <th>ğŸ‘¤ Usuario</th>
            <th>ğŸ“… Fecha</th>
            <th>ğŸ—’ï¸ ObservaciÃ³n</th>
          </tr>
        </thead>
            <tbody class="text-center">
                {% for m in movimientos %}    
                <tr>
                    <td>{{ m.inventario.color.nombre }}</td>
                    <td>{{ m.inventario.talla.nombre }}</td>
                    <td>{{ m.cantidad_historial }}</td>
                    <td>
                        {% if m.tipo_movimiento == "RecepciÃ³n ProducciÃ³n" %}
                            <span class="badge bg-success">{{ m.tipo_movimiento }}</span>

                        {% elif m.tipo_movimiento == "Ingreso Manual" %}
                            <span class="badge bg-primary">{{ m.tipo_movimiento }}</span>

                         {% elif m.tipo_movimiento == "DevoluciÃ³n" %}
                            <span class="badge bg-info text-dark">{{ m.tipo_movimiento }}</span>                          
                            

                        {% elif m.tipo_movimiento == "Ajuste Alta" %}
                            <span class="badge bg-warning text-dark">{{ m.tipo_movimiento }}</span>

                        {% elif m.tipo_movimiento == "Ajuste Baja" %}
                            <span class="badge bg-warning text-dark">{{ m.tipo_movimiento }}</span>

                        {% elif m.tipo_movimiento == "Salidas" %}
                            <span class="badge bg-warning text-dark">{{ m.tipo_movimiento }}</span>

                        {% elif m.tipo_movimiento == "Ventas" %}
                            <span class="badge bg-warning text-dark">{{ m.tipo_movimiento }}</span>

                        {% else %}
                            <span class="badge bg-danger">{{ m.tipo_movimiento }}</span>
                        {% endif %}
                    </td>                    
                    <td>{{ m.status.nombre }}</td>
                    <td>{{ m.usuario }}</td>
                    <td>{{ m.fecha_movimiento.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>{{ m.observaciones }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <!-- PAGINADOR -->
        {% if movimientos.pages > 1 %}
        <nav>
        <ul class="pagination justify-content-center">

            <!-- BotÃ³n Anterior -->
            <li class="page-item {% if not movimientos.has_prev %}disabled{% endif %}">
            <a class="page-link"
                href="{{ url_for('ver_historial_inventario',
                                page=movimientos.prev_num,
                                color_id=color_seleccionado,
                                talla_id=talla_seleccionada,
                                estado=estado_seleccionado) }}">
                Â« Anterior
            </a>
            </li>

            <!-- NÃºmeros de pÃ¡gina -->
            {% for p in movimientos.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if p %}
                <li class="page-item {% if movimientos.page == p %}active{% endif %}">
                <a class="page-link"
                    href="{{ url_for('ver_historial_inventario',
                                    page=p,
                                    color_id=color_seleccionado,
                                    talla_id=talla_seleccionada,
                                    estado=estado_seleccionado) }}">
                    {{ p }}
                </a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">â€¦</span></li>
            {% endif %}
            {% endfor %}

            <!-- BotÃ³n Siguiente -->
            <li class="page-item {% if not movimientos.has_next %}disabled{% endif %}">
            <a class="page-link"
                href="{{ url_for('ver_historial_inventario',
                                page=movimientos.next_num,
                                color_id=color_seleccionado,
                                talla_id=talla_seleccionada,
                                estado=estado_seleccionado) }}">
                Siguiente Â»
            </a>
            </li>

        </ul>
        </nav>
        {% endif %}
    </div>
    {% else %}
        <div class="alert alert-info text-center mt-3">
            No se han registrado movimientos en el historial.
        </div>
    {% endif %}
    </div>
</div>
{% endblock %}
